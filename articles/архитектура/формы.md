# Формы для ввода данных

В этой статье описана разработка форм ввода на React.

Задача любой формы - предоставить пользователю возможность описать экземпляр опредленной модели данных. Например, форма регистрации как правило используется для создания экземпляра модели `Account`, которая потом будет хранится в базе данных. 
## Значения формы и сопровождающие утилиты

Разработку формы ввода лучше всего начать с создания типа её значений, котрый будет описывать состояние формы на протяжении её жизненного цикла.

Несмотря на то, что форма используется для создания экземпляров определённой модели, значения формы не обязательно должны ей соответствовать, и это нормально. На самом деле, имеет смысл разделять их с самого начала. Это позволит системе быть более гибкой.

Представим ситуацию, когда при проектировании базы данных модель `Person` была описана с одним полем `fullName` для хранения информации об имени пользователя и форма регистрации изначально ей полностью соответствовала:

>> нужен скрин

Какое-то время спустя дизайнером было предложено разбить поле ввода полного имени на три отдельных поля соответсвенно для имени, фамилии и отчества. Менять модель базы даннных и производить миграцию для это не обязательно, так как храниться всё может по прежнему в поле `fullName` в виде сшитой строки. В этот момент и происходит явное расхождение хранимой модели и значений формы:

```js

type Person = {
    fullName: string;
}

type PersonFormValues = {
    firstName: string;
    middleName: string;
    lastName: string;
}

```

Это нормально для любого развивающегося проекта, поэтому имеет смысл разделять хранимую модель и модель представления (частью которой является модель значений формы) с самого начала, если тольно вы не занимаетесь прототипированием.

```js

type PersonFormValues = {
    name: string;
};

```

```js

const createPersonFormValues = (): Person => ({
    name: ''
});

```

## Тип нарушений и сопровождающие утилиты

```js

type Violation__EmptyName = {
    type: 'EmptyName';
}

type Violation__ShortName = {
    type: 'ShortName';
}

type PersonFormViolation = Violation__EmptyName | Violation__ShortName;

```

```js

const validatePersonFormValues = (values: PersonFormValues) => {
    const violations: PersonFormViolation[] = [];

    if (!values.name) {
        violations.push({
            type: 'EmptyName'
        })
    }

    if (values.name.length < NAME_MIN_LENGTH) {
        violations.push({
            type: 'ShortName'
        })
    }

    return violations;
}

```

## Реализация через локальное состояние

```jsx

const usePersonForm = () => {
    const [values, setValues] = React.useState<PersonFormValues>(createPersonFormValues);

    const [violations, setViolations] = React.useState<PersonFormViolation[]>([]);

    const setName = (nextValue: string) => {
        setValues(prevValues => ({
            ...prevValues,
            name: nextValue
        }))
    }

    React.useEffect(() => {
        setViolations(validatePersonFormValues(values))
    },[values])

    return { values, violations, setName }
}

```

## Реализация через глобальное состояние

TODO

## Подключение к пользовательскому интерфейсу

```jsx

const PersonForm = () => {
    const { values, violations, setName } = usePersonForm();

    const handleNameInputChange = (event) => {
        setName(event.target.value)
    }

    const handleSubmit = () => {
        if (violations.length === 0) {
            submitPersonForm({ values })
        }
    }

    const nameHint = selectNameViolationHint(violations)

    return(
        <form onSubmit={handleSubmit}>
            <label>
                Имя
                <br />
                <input
                    type="text"
                    name="name"
                    placeholder="Введите имя"
                    value={values.name}
                    onChange={handleNameInputChange}
                />
                <br />
                {nameHint && (
                    <small>{nameHint}</small>
                )}
            </label>
            <button type="submit">
                Отправить
            </button>
        </form>
    )    
}

```

## Отправка формы