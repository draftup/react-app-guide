# Интернационализация React-приложения

Судя по развернутому комментарию на сайте W3C интернационализация веб-приложения представляет собой совокупность архитектурных решений, упрощающих дальнейшую локализацию итогового продукта. Другими словами, интернационализация (i18n) является частью процесса разработки приложения, в то время как локализация уже относится к наполнению сайта контентом, соответствующим определенному языковому региону.

Примерами интернационализации являются: создание формы выбора языка интерфейса, работа с определенными браузерными API, проектирование интерфейса с учетом  rtl-языков.

Примерами локализации являются: перевод интерфейса на новый язык, перевод текста изображений, фильтрация контента для пользователей из определенного региона.

В этой статье я поделюсь опытом проектирования веб-приложения на React с учетом перевода на другие языки. Способ этот  не требует использования сторонних библиотек, полагается на стабильные React API и возможности современного JS.

## Контекст

Начнем с создания React-контекста, который будет использоваться для пробрасывания состояния локализации и доступа к нему изнутри компонентов:

_пример_

Провайдер контекста необходимо расположить как можно выше в иерархии компонентов, чтобы гарантировать доступ к состоянию локализации максимально возможному количеству компонентов:

_пример_

Теперь создадим компонент, который будет использовать словарь локализации. Для наглядности это будет компонент с одной единственной кнопкой:

_пример_

Обратите внимание, что мы до сих пор не определились, что эта кнопка будет делать. При этом имя в словаре уже обозначено как buttonText (а не submit, cancel, send). Такой подход к наимеменованию позволяет не привязывать имена значений к их содержимому ("Отправить", "Отменить", "Подтвердить") и если появится необходимость заменить текст кнопки, например, в английской локализации ("Submit" на "Confirm") вам не придется трогать имя в объекте словаря, чтобы оно продолжало соответствовать содержимому.

_пример_

Но откуда берется сам словарь? Для начала  будем его импортировать напрямую из отдельного файла. У меня эти файлы обычно лежат в папке src/i18n и называются по языковому коду:

_пример_

Сам словарь представляет собой js-объект, а файл, соответственно, полноценный js-модуль. Почему так, а не json? Чтобы можно было хранить в словаре функции:

_пример_

Структура словарей синхронизируется при помощи статической типизации. Тип словаря можно описывать и поддерживать явно, а можно выводить на основе одного из словарей, что делает жизнь проще.

_пример_

Обращение к словарю происходит напрямую из компонента с локализуемым контентом при помощи кастомного хука. Я предпочитаю для каждого компонента создавать свои небольшие микрословари. Это увеличивает размер основного словаря но вместе с тем обеспечивает гибкость локализации, которую легко ощутить при долгосрочной поддержке проекта.

_пример_

Необходимо создать статический тип, который будет помогать поддерживать в актуальном состоянии все имеющиеся i18n-словари;

Необходимо создать сервис, при помощи которого можно будет загрузить список языковых кодов от всех доступных словарей. Этот список потом можно будет использовать для предоставления пользователю возможность поменять локализацию при помощи выпадающего меню или какого-нибудь другого UI-элемента.

Необходимо создать сервис, при помощи которого можно будет загрузить словарь интернационализации по языковому коду. Этот сервис можно будет вызывать в момент, когда пользователь поменял язык приложения при помощи UI, а также в момент первой загрузки приложения, когда был автоматически определен предпочитаемый пользователем язык.

Необходимо подготовить все React-компоненты к работе с контекстом i18n. У каждого компонента будет существовать свой собственный микрословарь. Не стоит пытаться создавать словарь, отдельные строки которого могут использоваться в разных компонентах. Такой подход плохо масштабируется. Тем более не стоит пытаться вести словарь, ключи которого содержат семантическую связь с соответствующим ключу значением.

Нужно подготовить хранилище, в котором будут храниться список доступных языковых кодов а также загруженные словари. Если приложение уже имеет хранилище глобального состояния, то имеет смысл хранить эту информацию там.

Нужно создать хук, при помощи которого можно будет обращаться к актуальному i18n словарю. Сам хук, в свою очередь, будет обращаться к глобальному состоянию через соответствующий React Context.

Словарь интернационализации описывается в виде js-модуля. По одному модулю на локаль. Структура словарей синхронизируется при помощи статической типизации. Словарь может содержать не только строки, но и функции-конструкторы. Словари загружаются при помощи динамического импорта.