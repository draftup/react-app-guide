# Исходный код

**Исходным кодом** проекта называют набор файлов, содержащих в том числе программный код приложения, из которых при помощи дополнительной обработки можно получить итоговый продукт.

Исходный код, как правило, располагается в папке `/src` вашего проекта. Исходный код современных frontend-приложений (в том числе и React-приложений) собирается в итоговый продукт при помощи приложений-сборщиков. 

### Точка входа

Для начала сборки необходимо указать путь к **точке входа** - специальному файлу, который прямо и опосредованно ссылается на другие файлы проекта и таким образом включает в себя все необходимые части приложения.

В мире frontent-проложений в качестве точки входа часто вытупает `src/index.js` файл.

## Модули

### Сервисный метод

Функция, которая обращается к источникам данных при помощи соответсвующих environment API:

```ts

// Обращение к удаленному источнику при помощи Fetch API.

export const getGoogleKeepTasks = async () => {
    return fetch('keep.google.com/api/v1/tasks', { method: 'GET' })
}

// Обращение к локальному источнику при помощи LocalStorage API.

export const putTasksToLocalStorage = async (tasks: Task[]) => {
    window.localStorage.set('tasks', JSON.stringify(tasks));
}

```

### Нормализатор

Функция, которая возвращает декларативный интерфейс для привeдения сущности одного типа к другому.

```ts

export const normalizeGoogleKeepTask = (task: GoogleKeepTask) => {
    return {
        toTask(): Task {
            return {
                title: task.title,
                description: task.description,
                status: task.done ? 'DONE' : 'TO_DO'
            }
        }
    }
}

export const normalizeTask = (task: GoogleKeepTask) => {
    return {
        toGoogleKeepTask(): Task {
            return {
                title: task.title,
                description: task.description,
                done: task.status === 'DONE' ? true : false
            }
        }
    }
}

```

### Редюсер

Функция, которая меняет объект состояния в ответ на событие.

```ts

export const appStateReducer = (state: AppState, event: AppEvent) => {
    switch (event.name) {
        case 'INC':
            return state + 1;
        case 'DEC':
            return state - 1;
        default:
            return state;
    }
}

```

### Презентор

Функция, которая...

- содержит HTML-разметку,
- применяет к HTML-элмементам стили,
- работает с DOM API напрямую;

```tsx

export const Button = (props: Props) => {
    const { onClick, theme, text } = props;

    const className = theme === 'primary' ? 'button--primary' : 'button-secondary';

    return(
        <button
            className={className}
            onClick={onClick}
        >
            {text}
        </button>
    )
}

```

### Контейнер

Функция, которая...

- выводит локальные состояния UI на основе глобального состояния приложения,
- отправляет глобальные события в store в ответ на UI-события.

```tsx

export const CreateTaskControl = () => {

    const dispatch = useAppDispatch();

    const handleButtonClick = React.useCallback(() => {
        dispatch({
            name: 'CREATE_TASK_CONTROL__BUTTON_CLICK'
        });
    }, [dispatch]);

    const buttonDisabled = useTaskFormSubmited();

    return(
        <Button theme="primary" disabled={buttonDisabled} onClick={handleButtonClick} />
    )
}

```

### Модификатор

Функция, которая предоставляет декларативный интерфейс для изменения сущностей определенного типа.

```tsx

// Объявление

export const modifyTask = (task: Task) => {

    return {
        done() {
            return task
        },
        toggleDone() {
            return modifyTask({
                ...task,
                done: !task.done 
            });
        },
        setDescription(nextValue: string) {
            return modifyTask({
                ...task,
                description: nextValue
            });
        }
    }
}

```

```tsx

// Использование

let taskModifier = modifyTask(someTask)
    .setDescription('Next task description.')

if (someCondition) {
    taskModifier = taskModifier.toggleDone();
}

const modifiedTask = taskModifier.done();

```

### Селектор

Функция-хук, которая выводит и при необходимости мемоизируют побочное глобальное состояние.

```tsx

const useDoneTasksCount = () => {
    const { tasks } = useAppState();

    const doneTasks = React.useMemo(() => {
        return tasks.filter(task => task.done === true)
    }, [tasks]);

    return doneTasks.length;
}

```

### Контекст

```tsx

const AppStateContext = React.createContext<null | AppState>(null);

```

### Провайдер

React-компонент, который предоставляет дочернему дереву доступ к данным при помощи контекста.

```tsx

const AppStoreProvider = (props: Props) => {
    const { children } = props;

    const [state, dispatch] = React.useReducer(appReducer);

    return(
        <AppStateContext.Provider value={state}>
            <AppDispatchContext.Provider value={dispatch}>
                {children}
            </AppDispatchContext.Provider>
        </AppStateContext.Provider>
    )
};

```

## Файловая система

Файлы модулей можно группировать по разному принципу.

### Группировка по функциональной принадлежности

```
- src
-- methods
-- presentors
-- containers
-- normalizers
-- modifiers
-- contexts
-- providers
-- selectors
-- app
-- index.js
```

Плюсы подхода:
- простая ментальная модель позволяет легко ориентироваться в исходном коде;
- одноуровневая вложенность позволяет быстрее добраться до нужного модуля;
- одноуровневая вложенность избавляет от длинных import'ов;

Минусы подхода:
- неравномерная масштабируемость, когда одна папка может содержать один единственный файл и не меняться годами, в то время как другая папка будет регулярно наполняться файлами;

### Группировка по слоям

```
- src
--- service
----- adapters
------- adapter1
------- adapter2
--------- methods
--------- normalizers
--------- types
--------- adapter2.js
------- controllers
--------- useUserService.js
--------- useTaskService.js
----- useServiceLayer.js
--- view
----- presentors
------- buttons
--------- Button1
------- inputs
--------- Input1
------- layouts
--------- Layout1
----- containers
------- user
--------- UserAuthForm
----------- types
----------- UserAuthForm.jsx
----------- UserAuthFormView.jsx
--------- UserAuthScreen
--------- UserRegistrationForm
--------- UserRegistrationScreen
--- domain
----- types
----- reducers
----- selectors 
--- app
```