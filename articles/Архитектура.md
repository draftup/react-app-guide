# Архитектура

Архитектура приложения - набор характиристик, отражающих способность приложения к долгосрочному развитию и поддержке.

## Слои приложения

Чтобы обеспечитить контролируемое развитие и поддержку приложения, его исходный код можно разбить на несколько максимально изолированных друг от друга слоев. Каждый слой при этом отвечает за выполнение конкретной технической задачи.

Этот путеводитель придерживается следующей структуры слоев:

- **слой сервисов** обеспечивает обмен данными между слоем логики и внешними источниками данных.

> Под внешними источниками данных подразумеваются не только удаленные сервера, но и API среды выполнения (вроде Local Storage API, Geolocation API, а также методы и свойства window-объекта, такие как setTimeot).

- **слой логики** отвечает за изменение состояния приложения в ответ на события, приходящие из остальных слоев. 

- **cлой представления** отвечает за выведение локальных состояний, за интерпретацию пользовательских действий в виде понятных слою логики событий.

## Слой представления

Главным строительным блоком слоя представления является React-модуль.

*React-модуль* представляет собой объект, экспортирующий наружу *React-компонент* и опциональный *UNION-тип* генерируемых этим компонентом событий, если такие имеются.

```ts

import { MyComponent, MyComponentEvent } from './MyComponent';

```

Компонент может быть использован в других компонентах, как это обычно в React-приложениях и происходит.

Типы событий всех используемых компонентов будут объеденены в один UNION-тип для последующей типизации редюсера глобального состояния:

```ts

import { MyComponentEvent } from './MyComponent';
import { MyOtherComponentEvent } from './MyOtherComponent';

export type ViewEvent = MyComponentEvent | MyOtherComponentEvent;

```

## Модули

### Обращение к провайдерам данных

```ts

export const getGoogleKeepTasks = async () => {
    return fetch('keep.google.com/api/v1/tasks', { method: 'GET' })
}

```

```ts

export const putTasksToLocalStorage = async (tasks: Task[]) => {
    window.localStorage.set('tasks', JSON.stringify(tasks));
}

```

### Нормализация данных

Модули этой категории данных отвечают за приведение данных от внешних источников к локальному виду и наоборот.

```ts

export const normalizeGoogleKeepTask = {
    toTask(task: GoogleKeepTask): Task {
        return {
            title: task.title,
            description: task.description,
            status: task.done ? 'DONE' : 'TO_DO'
        }
    }
}

```

```ts

export const normalizeTask = {
    toGoogleKeepTask(task: GoogleKeepTask): Task {
        return {
            title: task.title,
            description: task.description,
            done: task.status === 'DONE' ? true : false
        }
    }
}

```

### Редюсеры состояний

```ts

export const appStateReducer = (state: AppState, event: AppEvent) => {
    switch (event.name) {
        case 'INC':
            return state + 1;
        case 'DEC':
            return state - 1;
        default:
            return state;
    }
}

```

### Презентационные компоненты

```tsx

export const Button = (props: Props) => {
    const { onClick, theme, text } = props;

    const className = theme === 'primary' ? 'button--primary' : 'button-secondary'

    return(
        <button
            className={className}
            onClick={onClick}
        >
            {text}
        </button>
    )
}

```

### Компоненты-контейнеры

```tsx

export const CreateTaskControl = () => {

    const handleButtonClick = React.useCallback(() => {
        dispatch({
            name: 'CREATE_TASK_CONTROL__BUTTON_CLICK'
        })
    },[])

    return(
        <Button theme="primary" onClick={handleButtonClick} />
    )
}

```